DK.Biodiv <- readxl::read_excel("~/Dropbox/Courses_&_Conferences/2022/Courses/Statistical and Geospatial Modeling/Lectures-Practical/Project/Biodiveristy/Biowide/occurrence.xlsx")
names(DK.Biodiv)
DK.Biodiv <- readxl::read_excel("~/Dropbox/Courses_&_Conferences/2022/Courses/Statistical and Geospatial Modeling/Lectures-Practical/Week 14 - Project/Biodiveristy/Biowide/occurrence.xlsx")
names(DK.Biodiv)
DK.Biodiv$phylum
unique(DK.Biodiv$phylum)
names(DK.Biodiv)
tapply(DK.Biodiv$scientificName, DK.Biodiv$phylum, function(x){length(x)})
tapply(DK.Biodiv$scientificName, DK.Biodiv$phylum, function(x){length(unique(x))})
tapply(DK.Biodiv$scientificName, DK.Biodiv$phylum, function(x){length(unqiue(x)})
tapply(DK.Biodiv$scientificName, DK.Biodiv$phylum, function(x){length(unqiue(x))})
tapply(DK.Biodiv$scientificName, DK.Biodiv$phylum, function(x){length(unique(x))})
60*3
180/2
180/24
qnorm(0.976)
rm(list=ls());gc()
require(raster)
require(mgcv)
# Load Ice Layers from ICE-6G-C
IceList <- readRDS(file = "~/Dropbox/Aarhus Assistant Professor/Projects/4. PopulationDensity-LGMtoNow/Data/IceMaps/ICE-6G-C/Ice0_5DD.RData")
PaleoPopDenEst50 <- readRDS("~/Dropbox/Aarhus Assistant Professor/Projects/4. PopulationDensity-LGMtoNow/Results/50Percent/PaleoPopDenEst50.RData")
## Estimate the Min PopDensity
PopDenFinalRast <- lapply(names(PaleoPopDenEst50), function(y){
PopDen <- PaleoPopDenEst50[[y]] # Load pop density estimates
# Remove MWM -  Might not be necessary latter on
if(sum(names(PopDen)%in%"MWM")!=0){
PopDen <- PopDen[[-which(names(PopDen)%in%"MWM")]]}
Ice <- IceList[[y]]==0 # load Ice sheets
PopDenCrop <- PopDen*Ice
PopDenCrop[is.infinite(PopDenCrop[])] <- NA
# calculate the Mim Popultion size the Limming factor Variable
calc(PopDenCrop,function(x){min(x)})
})
PopDenFinalList <- lapply(PopDenFinalRast,function(x){
mean(x[],na.rm=T)})
PopDen <- data.frame(density = do.call("rbind", PopDenFinalList),
time = seq(-21,-8,by=0.500))
# Estimate the smoothed trend in change in population density over time.
fit50 <- gam(density~s(time),
data = PopDen)
PopDen$mean <- predict(fit50)
PopDen$UpCI <- predict(fit50)+(qnorm(0.975)*predict(fit50, se.fit=T)$se.fit)
PopDen$LowCI <- predict(fit50)-(qnorm(0.975)*predict(fit50, se.fit=T)$se.fit)
par(mfrow=c(2,1),oma=rep(1,4),mar=c(4,4,1,1))
### PLot the mean estimated Density - 90th percentile
plot(density ~ time,data = PopDen,
pch = 19,cex=0.8,
type="b",
axes = F,
ylim = c(4,11),
xlim = c(-22,-7),
ylab = NA,
xlab=NA, cex.lab=1.5,
xpd=NA)
# Add Axes and legends
axis(1,
at=seq(-22,-7,by=3),
labels = paste0(seq(-22,-7,by=3)*-1,"kaBP"))
axis(2,las=2)
mtext("Mean density [individuals/100km2]",side=2,cex=0.8,line=3)
dev.new(width=6,height=10)
dev.new(width=6,height=10)
plot(density ~ time,data = PopDen,
pch = 19,cex=0.8,
type="b",
axes = F,
ylim = c(0.5,2),
xlim = c(-22,-7),
ylab = NA,
xlab=NA, cex.lab=1.5,
xpd=NA)
# Add Axes and legends
axis(1,
at=seq(-22,-7,by=3),
labels = paste0(seq(-22,-7,by=3)*-1,"kaBP"))
axis(2,las=2)
mtext("Mean density [individuals/100km2]",side=2,cex=0.8,line=3)
# Draw the smoothed changes in population density
lines(x = PopDen$time,
y = predict(fit90, se.fit=T)$fit,
lty = 1, col = "black", lwd = 1)
rm(list=ls());gc()
require(raster)
require(mgcv)
# Load Ice Layers from ICE-6G-C
IceList <- readRDS(file = "~/Dropbox/Aarhus Assistant Professor/Projects/4. PopulationDensity-LGMtoNow/Data/IceMaps/ICE-6G-C/Ice0_5DD.RData")
PaleoPopDenEst50 <- readRDS("~/Dropbox/Aarhus Assistant Professor/Projects/4. PopulationDensity-LGMtoNow/Results/50Percent/PaleoPopDenEst50.RData")
## Estimate the Min PopDensity
PopDenFinalRast <- lapply(names(PaleoPopDenEst50), function(y){
PopDen <- PaleoPopDenEst50[[y]] # Load pop density estimates
# Remove MWM -  Might not be necessary latter on
if(sum(names(PopDen)%in%"MWM")!=0){
PopDen <- PopDen[[-which(names(PopDen)%in%"MWM")]]}
Ice <- IceList[[y]]==0 # load Ice sheets
PopDenCrop <- PopDen*Ice
PopDenCrop[is.infinite(PopDenCrop[])] <- NA
# calculate the Mim Popultion size the Limming factor Variable
calc(PopDenCrop,function(x){min(x)})
})
PopDenFinalList <- lapply(PopDenFinalRast,function(x){
mean(x[],na.rm=T)})
PopDen <- data.frame(density = do.call("rbind", PopDenFinalList),
time = seq(-21,-8,by=0.500))
# Estimate the smoothed trend in change in population density over time.
fit50 <- gam(density~s(time),
data = PopDen)
PopDen$mean <- predict(fit50)
PopDen$UpCI <- predict(fit50)+(qnorm(0.975)*predict(fit50, se.fit=T)$se.fit)
PopDen$LowCI <- predict(fit50)-(qnorm(0.975)*predict(fit50, se.fit=T)$se.fit)
par(mfrow=c(1,1),oma=rep(1,4),mar=c(4,4,1,1))
### PLot the mean estimated Density - 90th percentile
plot(density ~ time,data = PopDen,
pch = 19,cex=0.8,
type="b",
axes = F,
ylim = c(0.5,2),
xlim = c(-22,-7),
ylab = NA,
xlab=NA, cex.lab=1.5,
xpd=NA)
axis(1,
at=seq(-22,-7,by=3),
labels = paste0(seq(-22,-7,by=3)*-1,"kaBP"))
axis(2,las=2)
mtext("Mean density [individuals/100km2]",side=2,cex=0.8,line=3)
# Draw the smoothed changes in population density
lines(x = PopDen$time,
y = predict(fit50, se.fit=T)$fit,
lty = 1, col = "black", lwd = 1)
lines(x= PopDen$time,
y= predict(fit50, se.fit=T)$fit-(qnorm(0.975)*predict(fit50, se.fit=T)$se.fit),
lty = 2,col = "black", lwd = 1)
lines(x= PopDen$time,
y= predict(fit50, se.fit=T)$fit+(qnorm(0.975)*predict(fit50, se.fit=T)$se.fit),
lty = 2,col = "black", lwd = 1)
### PLot the mean estimated Density - 90th percentile
plot(density ~ time,data = PopDen,
pch = 19,cex=0.8,
type="b",
axes = F,
ylim = c(0.5,2),
xlim = c(-22,-7),
ylab = NA,
xlab=NA, cex.lab=1.5,
xpd=NA)
# Add Axes and legends
axis(1,
at=seq(-22,-7,by=3),
labels = paste0(seq(-22,-7,by=3)*-1,"kaBP"))
axis(2,las=2)
mtext("Mean density [individuals/100km2]",side=2,cex=0.8,line=3)
# Draw the smoothed changes in population density
lines(x = PopDen$time,
y = predict(fit50, se.fit=T)$fit,
lty = 1, col = "black", lwd = 1)
lines(x= PopDen$time,
y= predict(fit50, se.fit=T)$fit-(qnorm(0.975)*predict(fit50, se.fit=T)$se.fit),
lty = 2,col = "black", lwd = 1)
lines(x= PopDen$time,
y= predict(fit50, se.fit=T)$fit+(qnorm(0.975)*predict(fit50, se.fit=T)$se.fit),
lty = 2,col = "black", lwd = 1)
mean(c(-12.9,-11.7)
)
